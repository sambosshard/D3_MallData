var data = {"name": "top50", "children": [{"name": "Retail", "children": [{"assets": 198.825, "profit": 13.643, "country": "United States", "marketValue": 221.106, "size": 485.252, "name": "Wal-Mart Stores"}, {"assets": 94.462, "profit": 5.291, "country": "United States", "marketValue": 79.839, "size": 177.526, "name": "CVS Health"}, {"assets": 35.63, "profit": 2.384, "country": "United States", "marketValue": 74.892, "size": 121.194, "name": "Costco Wholesale"}, {"assets": 72.505, "profit": 4.247, "country": "United States", "marketValue": 88.995, "size": 116.081, "name": "Walgreens Boots Alliance"}, {"assets": 37.525, "profit": 1.943, "country": "United States", "marketValue": 27.299, "size": 115.337, "name": "Kroger"}, {"assets": 42.966, "profit": 7.957, "country": "United States", "marketValue": 176.728, "size": 94.595, "name": "Home Depot"}]}, {"name": "Oil & Gas", "children": [{"assets": 216.711, "profit": 6.9866, "country": "China", "marketValue": 105.122, "size": 255.722, "name": "China Petroleum & Chemical"}, {"assets": 411.275, "profit": 4.6507, "country": "Netherlands", "marketValue": 228.793, "size": 234.751, "name": "Royal Dutch Shell"}, {"assets": 344.91, "profit": 1.1621, "country": "China", "marketValue": 204.477, "size": 214.76, "name": "PetroChina"}, {"assets": 330.314, "profit": 7.84, "country": "United States", "marketValue": 343.165, "size": 197.518, "name": "ExxonMobil"}, {"assets": 263.316, "profit": 0.115, "country": "United Kingdom", "marketValue": 114.695, "size": 183.834, "name": "BP"}, {"assets": 230.978, "profit": 6.1561, "country": "France", "marketValue": 128.122, "size": 128.067, "name": "Total"}, {"assets": 260.078, "profit": -0.497, "country": "United States", "marketValue": 206.083, "size": 110.484, "name": "Chevron"}, {"assets": 265.393, "profit": 12.141200000000001, "country": "Russia", "marketValue": 51.815, "size": 91.353, "name": "Gazprom"}]}, {"name": "Automotive", "children": [{"assets": 412.496, "profit": 17.1115, "country": "Japan", "marketValue": 171.85, "size": 249.902, "name": "Toyota Motor"}, {"assets": 458.742, "profit": 5.690300000000001, "country": "Germany", "marketValue": 72.941, "size": 240.34, "name": "Volkswagen Group"}, {"assets": 256.292, "profit": 9.4314, "country": "Germany", "marketValue": 76.099, "size": 169.537, "name": "Daimler"}, {"assets": 221.69, "profit": 9.427, "country": "United States", "marketValue": 50.792, "size": 166.38, "name": "General Motors"}, {"assets": 237.951, "profit": 4.596, "country": "United States", "marketValue": 44.718, "size": 151.8, "name": "Ford Motor"}, {"assets": 161.802, "profit": 3.9313000000000002, "country": "Japan", "marketValue": 51.382, "size": 127.865, "name": "Honda Motor"}, {"assets": 110.056, "profit": 1.9945, "country": "United Kingdom", "marketValue": 15.549, "size": 122.808, "name": "Fiat Chrysler Automobiles"}, {"assets": 84.989, "profit": 4.818, "country": "China", "marketValue": 43.491, "size": 112.725, "name": "SAIC Motor"}, {"assets": 157.269, "profit": 4.4651000000000005, "country": "Japan", "marketValue": 38.372, "size": 105.939, "name": "Nissan Motor"}, {"assets": 210.341, "profit": 7.5918, "country": "Germany", "marketValue": 57.732, "size": 104.163, "name": "BMW Group"}]}, {"name": "Finance & Insurance", "children": [{"assets": 620.854, "profit": 24.074, "country": "United States", "marketValue": 409.908, "size": 222.935, "name": "Berkshire Hathaway"}, {"assets": 192.992, "profit": 0.48260000000000003, "country": "Italy", "marketValue": 11.944, "size": 152.564, "name": "EXOR"}, {"assets": 3473.238, "profit": 41.9837, "country": "China", "marketValue": 229.805, "size": 151.381, "name": "ICBC"}, {"assets": 3016.578, "profit": 34.9814, "country": "China", "marketValue": 200.458, "size": 134.242, "name": "China Construction Bank"}, {"assets": 925.854, "profit": 6.152699999999999, "country": "France", "marketValue": 60.77, "size": 132.153, "name": "AXA Group"}, {"assets": 2522.131, "profit": 3.1245, "country": "Japan", "marketValue": 55.145, "size": 123.728, "name": "Japan Post Holdings"}, {"assets": 935.871, "profit": 7.614, "country": "Germany", "marketValue": 83.721, "size": 115.725, "name": "Allianz"}, {"assets": 2816.039, "profit": 27.7975, "country": "China", "marketValue": 149.229, "size": 115.698, "name": "Agricultural Bank of China"}, {"assets": 2611.539, "profit": 24.8566, "country": "China", "marketValue": 141.321, "size": 113.107, "name": "Bank of China"}, {"assets": 3287.968, "profit": 12.313, "country": "United States", "marketValue": 2.849, "size": 108.306, "name": "Fannie Mae"}, {"assets": 801.022, "profit": 9.4603, "country": "China", "marketValue": 100.811, "size": 106.606, "name": "Ping An Insurance Group"}, {"assets": 571.193, "profit": 1.6974, "country": "United Kingdom", "marketValue": 18.176, "size": 105.456, "name": "Legal & General Group"}, {"assets": 2512.986, "profit": 24.231, "country": "United States", "marketValue": 306.616, "size": 102.494, "name": "JPMorgan Chase"}, {"assets": 1943.443, "profit": 21.938, "country": "United States", "marketValue": 274.385, "size": 97.573, "name": "Wells Fargo"}, {"assets": 2196.847, "profit": 16.563, "country": "United States", "marketValue": 231.876, "size": 92.214, "name": "Bank of America"}, {"assets": 1795.099, "profit": 14.717, "country": "United States", "marketValue": 164.316, "size": 84.038, "name": "Citigroup"}, {"assets": 2190.672, "profit": 8.3706, "country": "France", "marketValue": 80.499, "size": 74.702, "name": "BNP Paribas"}, {"assets": 2374.986, "profit": 2.479, "country": "United Kingdom", "marketValue": 162.638, "size": 62.087, "name": "HSBC Holdings"}, {"assets": 1209.176, "profit": 10.141, "country": "China", "marketValue": 62.164, "size": 52.995, "name": "Bank of Communications"}, {"assets": 2589.758, "profit": 8.1545, "country": "Japan", "marketValue": 83.858, "size": 49.173, "name": "Mitsubishi UFJ Financial"}, {"assets": 855.07, "profit": 9.3814, "country": "China", "marketValue": 66.376, "size": 44.491, "name": "China Merchants Bank"}, {"assets": 872.1, "profit": 8.106399999999999, "country": "China", "marketValue": 45.126, "size": 44.297, "name": "Industrial Bank"}, {"assets": 415.579, "profit": 8.0677, "country": "Russia", "marketValue": 63.903, "size": 43.044, "name": "Sberbank"}, {"assets": 842.832, "profit": 7.9926, "country": "China", "marketValue": 50.451, "size": 40.06, "name": "Shanghai Pudong Development"}, {"assets": 891.096, "profit": 8.3485, "country": "Canada", "marketValue": 107.205, "size": 35.285, "name": "Royal Bank of Canada"}, {"assets": 63.37, "profit": 5.99, "country": "United States", "marketValue": 206.396, "size": 15.978, "name": "Visa"}]}, {"name": "Technology", "children": [{"assets": 331.141, "profit": 45.217, "country": "United States", "marketValue": 752.039, "size": 217.481, "name": "Apple"}, {"assets": 217.068, "profit": 19.320700000000002, "country": "South Korea", "marketValue": 254.303, "size": 173.995, "name": "Samsung Electronics"}, {"assets": 86.022, "profit": 2.371, "country": "United States", "marketValue": 427.011, "size": 135.987, "name": "Amazon.com"}, {"assets": 80.426, "profit": 4.61, "country": "Taiwan", "marketValue": 54.375, "size": 135.151, "name": "Hon Hai Precision"}, {"assets": 167.497, "profit": 19.478, "country": "United States", "marketValue": 579.499, "size": 89.92, "name": "Alphabet"}, {"assets": 224.61, "profit": 16.768, "country": "United States", "marketValue": 507.544, "size": 85.27, "name": "Microsoft"}, {"assets": 117.47, "profit": 11.872, "country": "United States", "marketValue": 162.365, "size": 79.918, "name": "IBM"}, {"assets": 113.327, "profit": 10.316, "country": "United States", "marketValue": 170.35, "size": 59.387, "name": "Intel"}, {"assets": 126.248, "profit": 9.832, "country": "United States", "marketValue": 165.059, "size": 48.57, "name": "Cisco Systems"}, {"assets": 125.382, "profit": 8.917, "country": "United States", "marketValue": 182.239, "size": 37.429, "name": "Oracle"}, {"assets": 58.533, "profit": 10.364, "country": "Taiwan", "marketValue": 161.734, "size": 29.392, "name": "Taiwan Semiconductor"}, {"assets": 64.961, "profit": 9.487, "country": "United States", "marketValue": 407.3, "size": 27.638, "name": "Facebook"}, {"assets": 56.968, "profit": 6.185, "country": "China", "marketValue": 277.122, "size": 22.831, "name": "Tencent Holdings"}, {"assets": 70.679, "profit": 5.7136000000000005, "country": "China", "marketValue": 264.865, "size": 21.493, "name": "Alibaba"}]}, {"name": "Pharmaceuticals", "children": [{"assets": 57.874, "profit": 2.03, "country": "United States", "marketValue": 30.517, "size": 196.498, "name": "McKesson"}, {"assets": 33.919, "profit": 1.3469, "country": "United States", "marketValue": 19.013, "size": 148.31, "name": "AmerisourceBergen"}, {"assets": 35.021, "profit": 1.352, "country": "United States", "marketValue": 25.978, "size": 127.235, "name": "Cardinal Health"}, {"assets": 171.615, "profit": 7.131, "country": "United States", "marketValue": 203.07, "size": 52.824, "name": "Pfizer"}, {"assets": 75.583, "profit": 9.7202, "country": "Switzerland", "marketValue": 219.267, "size": 51.338, "name": "Roche Holding"}, {"assets": 130.387, "profit": 6.6996, "country": "Switzerland", "marketValue": 193.163, "size": 48.52, "name": "Novartis"}, {"assets": 95.377, "profit": 3.92, "country": "United States", "marketValue": 173.328, "size": 39.555, "name": "Merck"}, {"assets": 56.977, "profit": 13.501, "country": "United States", "marketValue": 87.036, "size": 30.317, "name": "Gilead Sciences"}, {"assets": 41.137, "profit": 1.802, "country": "Germany", "marketValue": 49.092, "size": 16.62, "name": "Merck"}, {"assets": 128.986, "profit": 14.9734, "country": "Ireland", "marketValue": 80.068, "size": 14.967, "name": "Allergan"}]}, {"name": "Healthcare", "children": [{"assets": 125.037, "profit": 7.237, "country": "United States", "marketValue": 160.185, "size": 184.871, "name": "UnitedHealth Group"}]}, {"name": "Telecommunications", "children": [{"assets": 403.821, "profit": 12.976, "country": "United States", "marketValue": 249.286, "size": 163.786, "name": "AT&T"}, {"assets": 244.18, "profit": 13.127, "country": "United States", "marketValue": 198.352, "size": 125.98, "name": "Verizon Communications"}, {"assets": 218.864, "profit": 16.4234, "country": "Hong Kong", "marketValue": 225.308, "size": 106.763, "name": "China Mobile"}, {"assets": 180.257, "profit": 7.384600000000001, "country": "Japan", "marketValue": 92.23, "size": 104.972, "name": "Nippon Telegraph & Tel"}, {"assets": 213.204, "profit": 8.307, "country": "Japan", "marketValue": 78.632, "size": 82.136, "name": "Softbank"}, {"assets": 180.5, "profit": 8.695, "country": "United States", "marketValue": 193.528, "size": 80.403, "name": "Comcast"}]}, {"name": "Mining", "children": [{"assets": 124.6, "profit": -0.45330000000000004, "country": "Switzerland", "marketValue": 57.278, "size": 153.691, "name": "Glencore International"}]}, {"name": "Construction", "children": [{"assets": 201.364, "profit": 4.8643, "country": "China", "marketValue": 43.181, "size": 140.824, "name": "China State Construction Engineering"}]}, {"name": "Conglomerates", "children": [{"assets": 365.183, "profit": 10.02, "country": "United States", "marketValue": 261.174, "size": 119.69, "name": "General Electric"}]}, {"name": "Consumer Goods", "children": [{"assets": 129.779, "profit": 8.6594, "country": "Switzerland", "marketValue": 229.485, "size": 90.816, "name": "Nestle"}, {"assets": 141.208, "profit": 16.375, "country": "United States", "marketValue": 338.644, "size": 71.937, "name": "Johnson & Johnson"}, {"assets": 117.033, "profit": 9.533, "country": "United States", "marketValue": 228.115, "size": 65.231, "name": "Procter & Gamble"}, {"assets": 59.518, "profit": 5.7345, "country": "Netherlands", "marketValue": 143.891, "size": 58.311, "name": "Unilever"}]}, {"name": "Beverages", "children": [{"assets": 74.129, "profit": 6.329, "country": "United States", "marketValue": 159.406, "size": 62.801, "name": "PepsiCo"}, {"assets": 261.139, "profit": 1.2467000000000001, "country": "Belgium", "marketValue": 213.102, "size": 45.558, "name": "Anheuser-Busch InBev"}, {"assets": 87.27, "profit": 6.527, "country": "United States", "marketValue": 182.883, "size": 41.478, "name": "Coca-Cola"}]}, {"name": "Entertainment", "children": [{"assets": 91.576, "profit": 8.99, "country": "United States", "marketValue": 178.017, "size": 54.943, "name": "Walt Disney"}]}, {"name": "Tobacco", "children": [{"assets": 36.851, "profit": 6.947, "country": "United States", "marketValue": 176.221, "size": 26.714, "name": "Philip Morris International"}, {"assets": 45.932, "profit": 14.215, "country": "United States", "marketValue": 138.81, "size": 19.337, "name": "Altria Group"}]}]};

var colors_g = [
  "#FB84A3",
  "#F94877",
  "#FBD879",
  "#F9CA48",
  "#72F3EC",
  "#14E6DD",
  "#FB9F84",
  "#F97148",
  "#D8EE90",
  "#B4DE28",
  "#F0F3FA",
  "#D5D9E3",
  "#EBB114",
  "#10BCB3",
  "#D95026",
];

var fader = function(color) {
  return d3.interpolateRgb(color, "#fff")(0.0);
};

var diameter = 960,
  format = d3.format(",d"),
  color = d3.scaleOrdinal(colors_g.map(fader));

var bubble = d3.pack().size([diameter, diameter]).padding(1.5);

var svg = d3
  .select("#container")
  .append("svg")
  .attr("width", diameter + 200)
  .attr("height", diameter)
  .attr("class", "bubble")
  .attr("viewBox", "0 0 "+(diameter + 200)+" "+diameter)
  .attr("preserveAspectRatio","xMidYMid meet");

var root = d3.hierarchy(classes(data)).sum(function(d) {
  return d.value;
});
// .sort(function (a, b) { return b.value - a.value; });

bubble(root);

var defs = svg.append("defs");

//Make bubbles
var node = svg
  .selectAll(".node")
  .data(root.children)
  .enter()
  .append("g")
  .attr("class", "node")
  .attr("transform", function(d) {
    return "translate(" + d.x + "," + d.y + ")";
  });

node
  .append("circle")
  .attr("r", function(d) {
    return d.r;
  })
  .style("fill", function(d) {
    return "white";
  })
  .style("stroke", function(d) {
    return color(d.data.packageName);
  });

node
  .append("circle")
  .attr("r", function(d) {
    return Math.sqrt(Math.abs(d.data.profit / d.data.value * Math.pow(d.r, 2)));
  })
  .style("fill", function(d) {
    if (d.data.profit / d.data.value < 0) {
      return "white";
    }
    return color(d.data.packageName);
  })
  .style("stroke", function(d) {
    return color(d.data.packageName);
  });

function getPathData(radius, width, height) {
  // adjust the radius a little so our text's baseline isn't sitting directly on the circle
  var r = radius * 0.9;
  var startX = width / 2 - r;
  return (
    "M " +
    0 +
    ", " +
    0 +
    " m -" +
    r +
    ", 0 a " +
    r +
    "," +
    r +
    " 1 0,0 " +
    2 * r +
    ",0 a " +
    r +
    "," +
    r +
    " 0 1,0 -" +
    2 * r +
    "," +
    0
  );
  return (
    "m" +
    startX +
    "," +
    height +
    " " +
    "a" +
    r +
    "," +
    r +
    " 0 0 0 " +
    2 * r +
    ",0"
  );
}

for (i = 0; i < node.data().length; i++) {
  defs
    .append("path")
    .attr("d", function(d) {
      return getPathData(node.data()[i].r, 0, 0);
    })
    .attr("id", "p-" + node.data()[i].data.className);
}


//Make tool tip and hover animations
var tooltip = d3
  .select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("font-weight","300")
  .style("opacity", 0)
  .style("background-color", "#F0F3FA")
  .style("box-shadow", "0 1px 3px rgba(0, 0, 0, 0.25)")
  .style("position", "absolute")
  .style("z-index", 499)
  .style("top", "0px")
  .style("right", "0px")
  .style("bottom", "0px")
  .style("left", "0px")
  .style("width", 320 + "px")
  .style("height", 200 + "px");

node
  .append("text")
  .attr("transform", "rotate(90)")
  .append("textPath")
  .attr("xlink:href", function(d) {
    return "#p-" + d.data.className;
  })
  .attr("text-anchor", "middle")
  .attr("letter-spacing", ".2em")
  .attr("font-size", function(d) {
    if (d.r < 25) {
      return "0.5em";
    }
    if (d.r < 50) {
      return "0.75em";
    }
    return "1em";
  })
  .attr("startOffset", "50%")
.attr("font-weight","300")
  .text(function(d) {
    return d.data.className;
  });

node
  .on("mouseover", function(d) {
    tooltip.style("display", "block").style("opacity", 1);
    tooltip
      .html(
        '<table style="padding:10px;width:100%;"><tr><th style="font-weight: bold;" align="left">' +
          d.data.className +
          '</th><th style="font-weight: normal;color:' +
          color(d.data.packageName) +
          ';" align="right">' +
          d.data.packageName +
          '</th></tr><tr><td>Country:</td><td align="right">' +
          d.data.country +
          '</td></tr><tr><td>Revenue:</td><td align="right">$' +
          d.data.value.toFixed(0) +
          ' B</td></tr><tr><td>Profit:</td><td align="right">$' +
          d.data.profit.toFixed(0) +
          ' B</td></tr><tr><td>Profit Margin:</td><td align="right">' +
          (d.data.profit / d.data.value * 100).toFixed(1) +
          '%</td></tr><tr><td>Assets:</td><td align="right">$' +
          d.data.assets.toFixed(0) +
          ' B</td></tr><tr><td>Market Value:</td><td align="right">$' +
          d.data.marketValue.toFixed(0) +
          ' B</td></tr></table>'
      )
      .style("left", d3.event.pageX + -110 + "px")
      .style("top", d3.event.pageY + -255 + "px");
    var thisNode = d3.select(this);
    var trans = thisNode.attr("transform");
    thisNode
      .transition()
      .duration(200)
      .attr("transform", "translate(" + d.x + "," + d.y + ")" + "scale(1.1)");
    thisNode
      .select("text")
      .transition()
      .ease(d3.easeLinear)
      .duration(2500)
      .on("start", function repeat() {
        d3
          .active(this)
          .attr("transform", "rotate(0)")
          .transition()
          .attr("transform", "rotate(270)")
          .transition()
          .attr("transform", "rotate(180)")
          .transition()
          .attr("transform", "rotate(90)")
          .transition()
          .on("start", repeat);
      });
  })
  .on("mousemove", function(d) {
    tooltip
      .style("left", d3.event.pageX + -110 + "px")
      .style("top", d3.event.pageY + -225 + "px");
  })
  .on("mouseout", function(d) {
    tooltip.style("display", "none");
    var thisNode = d3.select(this);
    var trans = thisNode.attr("transform");
    thisNode
      .transition()
      .duration(200)
      .attr("transform", "translate(" + d.x + "," + d.y + ")");
    thisNode
      .select("text")
      .transition()
      .duration(200)
      .attr("transform", "rotate(90)");
  });

//Make Legends
var ordinal = color;

svg
  .append("g")
  .attr("class", "legendOrdinal")
  .attr("transform", "translate(960,630)");

var legendOrdinal = d3.legendColor().scale(ordinal);

svg
  .select(".legendOrdinal")
  .call(legendOrdinal).attr("font-weight","300")
  .append("text")
  .text("Industry")
  .attr("transform", "translate(0,-10)")
  .attr("font-weight", "bold");

  defs
    .append("path")
    .attr("d",getPathData(1.414*37.18392346343024, 0, 0))
    .attr("id", "key-rev");

  defs
    .append("path")
    .attr("d",getPathData((37.18392346343024/1.414)-2, 0, 0))
    .attr("id", "key-prof");
  

svg.select(".legendOrdinal").append("g").attr("class","legendKey").attr("transform", "translate(-100,242)").append("circle")
  .attr("r", 1.414*37.18392346343024)
  .style("fill", "white")
  .style("stroke", "#000000")
  .attr("stroke-dasharray","5, 5");

svg.select(".legendKey").append("circle")
  .attr("r", (37.18392346343024/1.414))
  .style("fill", "white")
  .style("stroke", "#000000")
  .attr("stroke-dasharray","5, 5");

svg.select(".legendKey").append("text")
  .attr("transform", "rotate(82)")
  .append("textPath")
  .attr("xlink:href", "#key-rev")
  .attr("text-anchor", "middle")
  .attr("letter-spacing", ".2em")
  .attr("font-size",".75em")
  .attr("startOffset", "50%")
.attr("font-weight","300")
  .text("$200 B • Revenue");

svg.select(".legendKey").append("text")
  .attr("transform", "rotate(90)")
  .append("textPath")
  .attr("xlink:href", "#key-prof")
  .attr("text-anchor", "middle")
  .attr("transform", "translate(0,5)")
  .attr("letter-spacing", ".2em")
  .attr("font-size",".75em")
  .attr("startOffset", "50%")
.attr("font-weight","300")
  .text("$50 B • Profit");

svg.select(".legendKey").append("text")
  .text("Scale/Key")
  .attr("text-anchor", "middle")
  .attr("transform", "translate(0,-65)")
  .attr("font-weight", "bold");

svg.select(".legendKey").append("text")
  .text("(unfilled if profit is a loss)")
  .attr("text-anchor", "middle")
  .attr("transform", "translate(0,70)")
.attr("font-weight","300")
.attr("font-size",".75em")

svg.append("a").attr("transform", "translate(0,940)").attr("xlink:href","https://www.forbes.com/global2000/list/").append("text").text("Source: 2017 Forbes Global 2000").attr("fill","#999999").attr("font-size",".75em").attr("font-weight","300");

//svg.append("text").attr("transform", "translate(0,30)").text("Top 100 Companies by Revenue and Profit").attr("font-size","1em").attr("font-weight","bold");

function unhighlight() {
    d3.selectAll(".node").classed("dimmed", false);
  }
//highlight selected catagory
  function highlight(ids) {
    // First unhighlight all the circles.
    unhighlight();

    // Find the circles that have an id
    // in the array of ids given, and 
    // highlight those.
    d3.selectAll(".node").filter(function(d, i) {
      return ids !== d.data.packageName;
    })
    .classed("dimmed", true);
  }

svg
  .selectAll(".cell").on("mouseover", function(d) {
    highlight(d);
}).on("mouseout", function(d) {unhighlight()});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children)
      node.children.forEach(function(child) {
        recurse(node.name, child);
      });
    else
      classes.push({
        packageName: name,
        className: node.name,
        value: node.size,
        profit: node.profit,
        country:node.country,
        assets:node.assets,
        marketValue:node.marketValue,
      });
  }

  recurse(null, root);
  return { children: classes };
}

d3.select(self.frameElement).style("height", diameter + "px");
//Make it auto scaling
var aspect = svg.attr("width") / svg.attr("height");
var container = svg._groups[0][0].parentElement;

d3.select(window).on("resize", function() {
    var targetWidth = container.clientWidth;
    svg.attr("width", targetWidth);
    svg.attr("height", Math.round(targetWidth / aspect));
}).on("resize")();